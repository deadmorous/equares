extends page
block vars
    - var title = 'Equares documentation'
block otherCss
    style.
        .doc-page {
            background-color: #ffd;
            padding: 5px 10px;
            height: 100%;
            overflow: auto;
        }
        .normal_container h1 {
            margin-top: 0px;
            margin-bottom: 5px;
        }
block otherScripts
    script(type='text/javascript' src='https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML')
    script(type='text/javascript' src='js-3rd/marked.min.js')
    script(type='text/javascript' src='js/format-info.js')
    script.

        formatInfo.init('doc-page')

        ctm.initPage.push(function(c1, c2, c3) {
            function wrap(tag) { return $("<" + tag + "></" + tag + ">") }

            var layoutOptions = {
                type: "horizontal",
                fixed: true,
                toolhandle: false
            }
            var content = $(c2.dom).html()
            c2.setTitle( "Documentation" )
            var layout = c2.setLayout( layoutOptions )
            var docMenuContainer, docPageContainer

            function onHashChange() {
                var h = location.hash.substr(1)
                if (!h)
                    return
                var url = location.origin + '/doc/' + h
                $.get(url)
                    .done(function(data) {
                        formatInfo.update(data)
                        var hi = h.split('/')
                        if (hi[0] == 'box')
                            $('#doc-menu-box').click()
                        else
                            $('#doc-menu-'+hi[1].split('-')[0]).click()
                    })
                    .fail(function(xhr) {
                        errorMessage(xhr.responseText || xhr.statusText || ("Failed to load docs menu: " + xhr.status))
                        docPageContainer.html(wrap('h1').text('N/A'))
                    })
            }

            $(window).on('hashchange', onHashChange)
            onHashChange()

            var menuCell = layout.add( { title: "Docs menu", width: {min: 50, max: 350} } )
            $.get('/doc-menu-pane')
                .done(function(data) {
                    docMenuContainer = $(data).appendTo($(menuCell.dom))
                })
                .fail(function(xhr) {
                    errorMessage(xhr.responseText || xhr.statusText || ("Failed to load docs menu: " + xhr.status))
                })

            var pageCell = layout.add( { title: "Docs content" } )
            docPageContainer = wrap('div').addClass('doc-page').attr('id', 'doc-page').appendTo($(pageCell.dom))
            docPageContainer.html(content)

            if (location.hash)
                loadDocPage('/doc/' + location.hash.substr(1))
        })
block content
    h1 Equares documentation
    | Choose an item in the documentation menu on the left.
