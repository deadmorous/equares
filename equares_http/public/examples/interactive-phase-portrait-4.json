{"name":"interactive-phase-portrait-4","description":"Interactive phase portrait, #4","info":"# Interactive phase portrait, part 4\n\nThis example is part of the ?[interactive phase portrait tutorial](/doc#tut/-/interactive-phase-portrait).\n\nThe objective is to have a simulation that adds phase trajectories that pass through points user clicks on the phase plane.\n\nIn this part, we add the ability to pan and zoom the region of phase plane corresponding to the output image. This is done with the help of the ?[RectInput](/doc#box/RectInput) box. Notice that we connect its output to both canvas and point input.\n","keywords":["phase portrait","phase trajectory","tutorial","tutorial interactive-phase-portrait","tutorial-order 400"],"script":"var h = 0.001\n","public":true,"definition":"{\"boxes\":[{\"name\":\"odeParam\",\"type\":\"Param\",\"props\":{\"data\":{\"value\":{\"l\":\"1\",\"g\":\"9.8\",\"n\":\"0.1\"}}},\"status\":{\"level\":\"ok\",\"text\":\"Ok\"},\"x\":169.671875,\"y\":132,\"ports\":[{\"pos\":3.5}]},{\"name\":\"initState\",\"type\":\"Param\",\"props\":{\"data\":{\"value\":{\"q\":0,\"dq\":0,\"t\":0}}},\"status\":{\"level\":\"ok\",\"text\":\"Ok\"},\"x\":606.671875,\"y\":132,\"ports\":[{\"pos\":2.544821062417123}]},{\"name\":\"ode\",\"type\":\"CxxOde\",\"props\":{\"src\":{\"value\":\"/*#\\ntitle: Damped pendulum\\nkeywords: pendulum\\n\\n# Damped pendulum\\n\\nThe damped pendulum equation of motion is as follows:\\n$$\\n\\\\ddot\\\\varphi + 2n\\\\dot\\\\varphi + \\\\frac gl \\\\sin\\\\varphi = 0\\n$$\\nIt is similar to ?[simple pendulum](/doc#box/Pendulum),\\nbut here we have the additional term $2n\\\\dot\\\\varphi$.\\n*/\\n\\n#include <cmath>\\n\\nstruct DampedPendulum {\\n    int paramCount() const {\\n        return 3;       // l, g, n\\n    }\\n    const char *paramNames() const {\\n        return \\\"l,g,n\\\";   // Can also return empty string or null ptr\\n    }\\n    int varCount() const {\\n        return 2;       // q, dq\\n    }\\n    const char *varNames() const {\\n        return \\\"q,dq\\\";  // Can also return empty string or null ptr\\n    }\\n\\n    // Auxiliary parameters\\n    double g_l, _2n;\\n    void prepare(const double *param) {\\n        g_l = param[1]/param[0];\\n        _2n = 2*param[2];\\n    }\\n\\n    void rhs(double *out, const double *param, const double *state) const {\\n        out[0] = state[1];\\n        out[1] = -g_l * sin(state[0]) - _2n*state[1];\\n    }\\n};\\n\\n\"},\"srcExample\":{\"value\":\"#include <cmath>\\n\\nstruct pendulum {\\n    int paramCount() const {\\n        return 2;       // l, g\\n    }\\n    const char *paramNames() const {\\n        return \\\"l,g\\\";   // Can also return empty string or null ptr\\n    }\\n    int varCount() const {\\n        return 2;       // q, dq\\n    }\\n    const char *varNames() const {\\n        return \\\"q,dq\\\";  // Can also return empty string or null ptr\\n    }\\n\\n    // Auxiliary parameters\\n    double g_l;\\n    void prepare(const double *param) {\\n        g_l = param[1]/param[0];\\n    }\\n\\n    void rhs(double *out, const double *param, const double *state) const {\\n        out[0] = state[1];\\n        out[1] = -g_l * sin(state[0]);\\n    }\\n};\\n\"},\"useQmake\":{\"value\":true}},\"status\":{\"level\":\"ok\",\"text\":\"Ok\"},\"x\":192.671875,\"y\":206,\"ports\":[{\"pos\":1.4908018355819235},{\"pos\":0.7},{\"pos\":0.3}]},{\"name\":\"solver\",\"type\":\"Rk4\",\"props\":{},\"status\":{\"level\":\"ok\",\"text\":\"Ok\"},\"x\":331.671875,\"y\":206,\"ports\":[{\"pos\":1.8918301873981531},{\"pos\":1.2566593035343034},{\"pos\":2.7},{\"pos\":0.5},{\"pos\":3.886963717673304},{\"pos\":2.3},{\"pos\":3.565590293235549}]},{\"name\":\"canvas\",\"type\":\"Canvas\",\"props\":{\"param\":{\"value\":{\"x\":{\"vmin\":\"-6\",\"vmax\":\"6\",\"resolution\":350},\"y\":{\"vmin\":\"-12\",\"vmax\":\"12\",\"resolution\":350}}},\"refreshInterval\":{\"value\":0},\"timeCheckCount\":{\"value\":100},\"clearOnRestart\":{\"value\":false},\"withInputValue\":{\"value\":false}},\"status\":{\"level\":\"ok\",\"text\":\"Ok\"},\"x\":375.671875,\"y\":359.9999694824219,\"ports\":[{\"pos\":1.4664109158675749},{\"pos\":1.9227032111565825},{\"pos\":2.5},{\"pos\":0.551923360595283},{\"pos\":3.5}]},{\"name\":\"bitmap\",\"type\":\"Bitmap\",\"props\":{\"fileName\":{\"value\":\"result.png\"},\"valueRange\":{\"value\":{\"vmin\":\"0\",\"vmax\":\"1\"}},\"colorMap\":{\"value\":[{\"pos\":0,\"color\":16777215},{\"pos\":\"1\",\"color\":0}]}},\"status\":{\"level\":\"ok\",\"text\":\"Ok\"},\"x\":379.6718444824219,\"y\":423,\"ports\":[{\"pos\":1.529644631502921}]},{\"name\":\"proj\",\"type\":\"Projection\",\"props\":{\"indices\":{\"value\":[0,1]}},\"status\":{\"level\":\"ok\",\"text\":\"Ok\"},\"x\":398.65625,\"y\":276,\"ports\":[{\"pos\":1.816985596707819},{\"pos\":3.3977564102564104}]},{\"name\":\"isInput\",\"type\":\"PointInput\",\"props\":{\"transform\":{\"value\":{\"x\":{\"index\":0,\"vmin\":\"-6\",\"vmax\":\"6\",\"resolution\":350},\"y\":{\"index\":1,\"vmin\":\"-12\",\"vmax\":\"12\",\"resolution\":350}}},\"refBitmap\":{\"value\":\"result.png\"},\"restartOnInput\":{\"value\":false},\"activateBeforeRestart\":{\"value\":false}},\"status\":{\"level\":\"ok\",\"text\":\"Ok\"},\"x\":462.0000305175781,\"y\":133,\"ports\":[{\"pos\":1.2925837320574163},{\"pos\":0.48625850340136056},{\"pos\":3.6412795125666415},{\"pos\":1.9562461995057552}]},{\"name\":\"isSplit\",\"type\":\"Split\",\"props\":{\"outputPortCount\":{\"value\":3}},\"status\":{\"level\":\"ok\",\"text\":\"Ok\"},\"x\":364,\"y\":63,\"ports\":[{\"pos\":3.817868761867822},{\"pos\":3.382523258021644},{\"pos\":0.26120536844770825},{\"pos\":0.6562173458725182}]},{\"name\":\"solverParam\",\"type\":\"Param\",\"props\":{\"data\":{\"value\":{\"h\":\"h\",\"n\":\"100000\",\"nout\":\"1\"}}},\"status\":{\"level\":\"ok\",\"text\":\"Ok\"},\"x\":213,\"y\":63,\"ports\":[{\"pos\":3.9320349119120737}]},{\"name\":\"clickedPoints\",\"type\":\"Dump\",\"props\":{\"fileName\":{\"value\":\"clickedPoints.txt\"}},\"status\":{\"level\":\"ok\",\"text\":\"Ok\"},\"x\":497,\"y\":64,\"ports\":[{\"pos\":2.7073139791961145},{\"pos\":2.3081353491720664}]},{\"name\":\"pause\",\"type\":\"Pause\",\"props\":{},\"status\":{\"level\":\"ok\",\"text\":\"Ok\"},\"x\":134,\"y\":388,\"ports\":[{\"pos\":1.5}]},{\"name\":\"pan-zoom\",\"type\":\"RectInput\",\"props\":{\"initRect\":{\"value\":{\"xmin\":\"-6\",\"xmax\":\"6\",\"ymin\":\"-12\",\"ymax\":\"12\"}},\"keepAspectRatio\":{\"value\":false},\"withActivator\":{\"value\":false},\"restartOnInput\":{\"value\":true},\"refBitmap\":{\"value\":\"result.png\"}},\"status\":{\"level\":\"ok\",\"text\":\"Ok\"},\"x\":572.8333282470703,\"y\":299,\"ports\":[{\"pos\":2.559498001500024}]}],\"links\":[{\"source\":{\"box\":\"solver\",\"port\":\"nextState\"},\"target\":{\"box\":\"proj\",\"port\":\"input\"}},{\"source\":{\"box\":\"initState\",\"port\":\"output\"},\"target\":{\"box\":\"isInput\",\"port\":\"input\"}},{\"source\":{\"box\":\"ode\",\"port\":\"parameters\"},\"target\":{\"box\":\"odeParam\",\"port\":\"output\"}},{\"source\":{\"box\":\"ode\",\"port\":\"state\"},\"target\":{\"box\":\"solver\",\"port\":\"rhsState\"}},{\"source\":{\"box\":\"ode\",\"port\":\"oderhs\"},\"target\":{\"box\":\"solver\",\"port\":\"rhs\"}},{\"source\":{\"box\":\"canvas\",\"port\":\"output\"},\"target\":{\"box\":\"bitmap\",\"port\":\"input\"}},{\"source\":{\"box\":\"isSplit\",\"port\":\"input\"},\"target\":{\"box\":\"isInput\",\"port\":\"output\"}},{\"source\":{\"box\":\"isInput\",\"port\":\"range\"},\"target\":{\"box\":\"pan-zoom\",\"port\":\"output\"}},{\"source\":{\"box\":\"canvas\",\"port\":\"range\"},\"target\":{\"box\":\"pan-zoom\",\"port\":\"output\"}},{\"source\":{\"box\":\"proj\",\"port\":\"output\"},\"target\":{\"box\":\"canvas\",\"port\":\"input\"}},{\"source\":{\"box\":\"isSplit\",\"port\":\"out_1\"},\"target\":{\"box\":\"solver\",\"port\":\"initState\"}},{\"source\":{\"box\":\"solverParam\",\"port\":\"output\"},\"target\":{\"box\":\"solver\",\"port\":\"parameters\"}},{\"source\":{\"box\":\"isSplit\",\"port\":\"out_3\"},\"target\":{\"box\":\"clickedPoints\",\"port\":\"flush\"}},{\"source\":{\"box\":\"clickedPoints\",\"port\":\"input\"},\"target\":{\"box\":\"isSplit\",\"port\":\"out_2\"}},{\"source\":{\"box\":\"solver\",\"port\":\"finish\"},\"target\":{\"box\":\"canvas\",\"port\":\"flush\"}}]}"}